"use strict";var app=require("app"),fs=require("fs"),ipc=require("ipc"),dialog=require("dialog"),BrowserWindow=require("browser-window");require("crash-reporter").start();var mainWindow=null;app.on("window-all-closed",function(){"darwin"!=process.platform&&app.quit()});var cleanArray=function(i){if("undefined"!=typeof i)for(var n=0;n<i.length;n++)""===i[n]&&(i.splice(n,1),n--)};app.on("ready",function(){mainWindow=new BrowserWindow({width:500,height:600}),mainWindow.loadUrl("file://"+__dirname+"/index.html"),mainWindow.on("closed",function(){mainWindow=null});var i={},n={};i.getFiles=function(i){var n={plugins:[],modlist:[],ini:[],prefsini:[]},e="";e="undefined"!=typeof i?i:dialog.showOpenDialog({properties:["openDirectory"],title:"Find your mod profile folder"});try{n.plugins=fs.readFileSync(e+"/plugins.txt","utf8").split("\r\n")}catch(o){console.log("plugins read failed:",o)}try{n.modlist=fs.readFileSync(e+"/modlist.txt","utf8").split("\r\n")}catch(o){console.log("plugins read failed:",o)}try{n.ini=fs.readFileSync(e+"/skyrim.ini","utf8").split("\r\n")}catch(o){console.log("plugins read failed:",o)}try{n.prefsini=fs.readFileSync(e+"/skyrimprefs.ini","utf8").split("\r\n")}catch(o){console.log("plugins read failed:",o)}cleanArray(n.plugins),cleanArray(n.modlist),cleanArray(n.ini),cleanArray(n.prefsini),mainWindow.webContents.send("filesread",JSON.stringify(n)),mainWindow.webContents.send("mo.filepath",e)},n.getPlugins=function(i){var n={plugins:[],modlist:[]},e="";e="undefined"!=typeof i?i:dialog.showOpenDialog({properties:["openDirectory"],title:"Find your plugins.txt folder"});try{n.plugins=fs.readFileSync(e+"/plugins.txt","utf8").split("\n")}catch(o){console.log("plugins read failed:",o)}cleanArray(n.plugins),mainWindow.webContents.send("filesread",JSON.stringify(n)),mainWindow.webContents.send("nmm.pluginsFile",e)},n.getIni=function(i){var n={modlist:[],ini:[],prefsini:[]},e="";e="undefined"!=typeof i?i:dialog.showOpenDialog({properties:["openDirectory"],title:"Find your .ini files"});try{n.ini=fs.readFileSync(e+"/skyrim.ini","utf8").split("\n")}catch(o){console.log("ini read failed:",o)}try{n.prefsini=fs.readFileSync(e+"/skyrimprefs.ini","utf8").split("\n")}catch(o){console.log("prefsini read failed:",o)}cleanArray(n.ini),cleanArray(n.prefsini),mainWindow.webContents.send("filesread",JSON.stringify(n)),mainWindow.webContents.send("nmm.iniFiles",e)},ipc.on("mo.getFiles",function(n){i.getFiles()}),ipc.on("nmm.getPluginsFile",function(i){n.getPlugins()}),ipc.on("nmm.getIniFiles",function(i){n.getIni()}),ipc.on("mo.getFilesNoDialog",function(n,e){i.getFiles(e)}),ipc.on("nmm.getPluginsFileNoDialog",function(i,e){n.getPlugins(e)}),ipc.on("nmm.getIniFilesNoDialog",function(i,e){n.getIni(e)})});